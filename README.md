# Video-API

![Actions badge](https://github.com/yoshiki-bull/Video-API/actions/workflows/github-actions.yml/badge.svg)  

[![codecov](https://codecov.io/gh/yoshiki-bull/Last-lecture/branch/main/graph/badge.svg?token=3HTE7KUY9C)](https://codecov.io/gh/yoshiki-bull/Last-lecture)

[![My Skills](https://skillicons.dev/icons?i=java,spring,mysql&theme=light)](https://skillicons.dev)  

[![My Skills](https://skillicons.dev/icons?i=docker,aws,idea)](https://skillicons.dev)  


## APIæ¦‚è¦
Udemyã‚’å‚è€ƒã«ã—ãŸå‹•ç”»æ•™æã®CRUDå‡¦ç†ã‚’æƒ³å®šã—ãŸRESTAPIã§ã™ã€‚

## è¦ä»¶
- CRUDå‡¦ç†ã‚’ã™ã¹ã¦å‚™ãˆãŸREST APIã®ä½œæˆ
- ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
- ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ã§å®Ÿè¡Œã™ã‚‹CIã®æ§‹ç¯‰(GitHub Actions)
- 3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åŸºã¥ã„ãŸè¨­è¨ˆ [(PRãƒªãƒ³ã‚¯)](https://github.com/yoshiki-bull/Last-lecture/pull/19#issue-1750970087)  
- APIã‚’EC2ä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ [(PRãƒªãƒ³ã‚¯)](https://github.com/yoshiki-bull/Video-API/pull/25#issue-1761688461)

## ä½¿ç”¨æŠ€è¡“
- Java 17.0.5
- Spring Boot 3.0.4
- OpenAPI Specification 3.0.0
- O/Rãƒãƒƒãƒ‘ãƒ¼
  - MyBatis 3.0.0
- Docker
  - MySQL 8.0
- AWS
  - VPC
  - EC2
  - RDS

## IDE
- IntelliJ IDEA

## ä»Šå¾Œã«å‘ã‘ã¦ã®æ°—ã¥ããƒ»å­¦ã³
- **è‹±èªã‚¹ã‚­ãƒ«ã¯å¿…é ˆ**  
ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å­¦ç¿’ãŠã‚ˆã³ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã®é›£ã—ã•ã¯ã€è‹±èªã‚„èã„ãŸã“ã¨ã‚‚ãªã„ã‚«ã‚¿ã‚«ãƒŠãŒé »å‡ºã™ã‚‹ã¨ã“ã‚ã ã¨æ€ã„ã¾ã™ã€‚  
è‹±èªãŒã§ãã‚Œã°ã€å˜èªã‹ã‚‰ã‚ã‚‹ç¨‹åº¦ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã§ãã‚‹ã‚‚ã®ã‚’è‹±èªãŒã§ããªã‘ã‚Œã°ã„ã¡ã„ã¡è‹±èªã®æ„å‘³ã‹ã‚‰èª¿ã¹ã‚‹æ‰‹é–“ãŒå¢—ãˆã¾ã™ã€‚  
ã€Œå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€ã€ã€Œã‚¨ãƒ©ãƒ¼æ–‡ã‚’èª­ã‚€ã€ã€Œã‚¨ãƒ©ãƒ¼ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹æ³•ã‚’èª¿ã¹ã‚‹ã€  
ã“ã‚Œã‚‰ã¯é–‹ç™ºã‚’ã™ã‚‹ä¸Šã§å¿…ãšæ±‚ã‚ã‚‰ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã—ã€è‹±èªãŒèª­ã‚ãªã‘ã‚Œã°å›°ã‚‹å ´é¢ãŒã§ã¦ãã‚‹ã¨æ€ã„ã¾ã™ã€‚  
ãªã®ã§ã€è‹±èªã‚‚å‹‰å¼·ã—ã¦ã¾ã™ğŸ™‹â€â™‚ï¸  
<br>

- **ã‚„ã‚Œã°ã§ãã‚‹**  
ç§ã¯ã“ã®ã‚·ãƒ³ãƒ—ãƒ«ãªAPIã‚’ä½œã‚‹ã ã‘ã§ã‚‚ã‹ãªã‚Šè‹¦åŠ´ã—ã¾ã—ãŸã€‚  
ä¸­ã§ã‚‚ã€Œãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã€ã€ŒCIã®æ§‹ç¯‰ã€ã€ŒAPIã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã¯å˜ã«ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ã¨ã¯ã¾ãŸæ¯›è‰²ãŒç•°ãªã‚Šã€  
ã‚¹ã‚¿ãƒ–ã‚„ãƒ¢ãƒƒã‚¯ã€ã‚¢ã‚µãƒ¼ãƒˆã¨ã„ã£ãŸæ–°ã—ã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€æ§˜ã€…ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ´»ç”¨ã€æ–°ã—ã„ãƒ„ãƒ¼ãƒ«ã®ä½¿ç”¨ãªã©  
å­¦ç¿’ã™ã‚‹ã“ã¨ãŒå¤šãç†è§£ã«è‹¦ã—ã¿ã€è©°ã¾ã‚‹æ™‚ã‚‚å¤šã€…ã‚ã‚Šã¾ã—ãŸã€‚  
ã—ã‹ã—ã€ãã†ã„ã£ãŸçŠ¶æ³ä¸‹ã®ä¸­ã§ã‚‚ä¸€æ—¦çŠ¶æ³ã‚’æ•´ç†ã—ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ´—ã„å‡ºã™ãªã©ã—ã¦ä¹—ã‚Šè¶Šãˆã¦ãã¾ã—ãŸã€‚  
ã¾ãŸã€è¦‹å½“ã‚‚ã¤ã‹ãªã„ã‚ˆã†ãªå ´åˆã«ã¯äººã‚’é ¼ã‚‹ã“ã¨ã‚‚å¤§åˆ‡ã ã¨è€ƒãˆã¦ã¾ã™ã€‚

## ä»Šå¾Œã®å±•æœ›
- ãƒ•ãƒ­ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®å®Ÿè£…
- è¤‡é›‘ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ
- å®Ÿç”¨çš„ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆ

## æˆæœç‰©

### [APIä»•æ§˜æ›¸(Swagger UI)](https://yoshiki-bull.github.io/Video-API/)

- **[APIä»•æ§˜æ›¸ã‚’GitHub Pagesã«ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ã¾ã§ã®æ‰‹é †](https://github.com/yoshiki-bull/Last-lecture/pull/23)**

![Swagger UI](images/document.png)

---

### ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆå›³

<img src="images/infrastructure.png" width="40%">

---

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ¦‚ç•¥å›³

![Application diagram](images/app-diagram.png)

---

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
â””â”€â”€ com
    â””â”€â”€ udemy
        â””â”€â”€ videolist
            â”œâ”€â”€ VideoListApplication.java
            â”œâ”€â”€ application
            â”‚Â Â  â”œâ”€â”€ controller
            â”‚Â Â  â”‚Â Â  â””â”€â”€ VideoController.java
            â”‚Â Â  â”œâ”€â”€ exception
            â”‚Â Â  â”‚Â Â  â”œâ”€â”€ VideoNotFoundException.java
            â”‚Â Â  â”‚Â Â  â””â”€â”€ VideoNotFoundExceptionHandler.java
            â”‚Â Â  â”œâ”€â”€ form
            â”‚Â Â  â”‚Â Â  â””â”€â”€ VideoForm.java
            â”‚Â Â  â””â”€â”€ response
            â”‚Â Â      â”œâ”€â”€ VideoCreateResponse.java
            â”‚Â Â      â”œâ”€â”€ VideoResponse.java
            â”‚Â Â      â””â”€â”€ VideoUpdateResponse.java
            â”œâ”€â”€ domain
            â”‚Â Â  â”œâ”€â”€ model
            â”‚Â Â  â”‚Â Â  â””â”€â”€ Video.java
            â”‚Â Â  â”œâ”€â”€ repository
            â”‚Â Â  â”‚Â Â  â””â”€â”€ VideoRepository.java
            â”‚Â Â  â””â”€â”€ service
            â”‚Â Â      â”œâ”€â”€ VideoService.java
            â”‚Â Â      â””â”€â”€ VideoServiceImpl.java
            â””â”€â”€ infrastructure
                â”œâ”€â”€ mapper
                â”‚Â Â  â””â”€â”€ VideoMapper.java
                â””â”€â”€ repository
                    â””â”€â”€ VideoRepositoryImpl.java

```

---

### ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
- **Serviceãƒ†ã‚¹ãƒˆ**  
  [ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰](https://github.com/yoshiki-bull/Last-lecture/blob/main/src/test/java/com/udemy/videolist/domain/service/VideoServiceImplTest.java)
- **Repositoryãƒ†ã‚¹ãƒˆ**  
  [ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰](https://github.com/yoshiki-bull/Last-lecture/blob/main/src/test/java/com/udemy/videolist/infrastructure/mapper/VideoMapperTest.java)
- **çµåˆãƒ†ã‚¹ãƒˆ**  
  [ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰](https://github.com/yoshiki-bull/Last-lecture/blob/main/src/test/java/com/udemy/videolist/integrationtest/VideoRestApiIntegrationTest.java)
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**

![Codecov](images/codecov.png)

---

### GitHub Actionsã‚’ç”¨ã„ãŸè‡ªå‹•CI

- **Event**

```
on:
  push:
    branches: [main]
  pull_request:
```
<br>

- **Runner**

```
 runs-on: ubuntu-latest
```
<br>

- **Step 1: ãƒªãƒã‚¸ãƒˆãƒªã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ**

```
uses: actions/checkout@v3
```
<br>

- **Step 2: æŒ‡å®šã—ãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®JDKã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹**

```
uses: actions/setup-java@v3
```
<br>

- **Step 3: Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã•ã›ã‚‹**

```
run: docker compose up -d
```
<br>

- **Step 4: testã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹**

```
run: ./gradlew test
```

<details>
<summary>æ©Ÿèƒ½</summary>

| æ©Ÿèƒ½              | èª¬æ˜                                                                         |
|-----------------|----------------------------------------------------------------------------|
| ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰  | ã‚¯ãƒ©ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãŒ<br>`build/classes/test/`é…ä¸‹ã«ç”Ÿæˆã•ã‚Œã‚‹                                  |
| ãƒ†ã‚¹ãƒˆçµæœãƒ¬ãƒãƒ¼ãƒˆ       | ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œçµæœã‚’ã¾ã¨ã‚ãŸãƒ¬ãƒãƒ¼ãƒˆ`index.html`ãŒ<br>`build/reports/tests`é…ä¸‹ã«ç”Ÿæˆã•ã‚Œã‚‹            |
| JUnitãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ    | JUnitãƒ†ã‚¹ãƒˆã®ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆãŒXMLå½¢å¼ã§<br>`**/build/test-results/test/TEST-*.xml`ã¨ã—ã¦ç”Ÿæˆã•ã‚Œã‚‹ |
</details>
<br>

- **Step 5: JUnitãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã‚’åé›†ã—ãƒ†ã‚¹ãƒˆçµæœã‚’PRã®Checksã«å ±å‘Šã™ã‚‹**

```
uses: mikepenz/action-junit-report@v3
```

<details>
<summary>æ©Ÿèƒ½</summary>

| æ©Ÿèƒ½     | èª¬æ˜                                                                               |
|--------|----------------------------------------------------------------------------------|
| Checks | PRã®Checksã«çµæœã‚’è¡¨ç¤ºã—ã¦ãã‚Œã‚‹ ![checks](images/checks.png)                                |
| ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ | ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã«`Annotations`ã‚’ç”Ÿæˆã—ã€<br>PRä¸Šã§ã©ã®ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ãŸã®ã‹æ•™ãˆã¦ãã‚Œã‚‹ ![failed](images/failed.png) |
</details>
<br>

- **Step 6: Checkstyleã§ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã«å•é¡ŒãŒãªã„ã‹ç¢ºèªã™ã‚‹**

```
uses: nikitasavinov/checkstyle-action@master
```

<details>
<summary>æ©Ÿèƒ½</summary>

| æ©Ÿèƒ½            | èª¬æ˜                                                                                         |
|---------------|--------------------------------------------------------------------------------------------|
| Checkstyle    | Checkstyleã¯Javaã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã«<br>å³ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ç¢ºèªã™ã‚‹ãŸã‚ã®lint(é™çš„è§£æ)ãƒ„ãƒ¼ãƒ«ã€‚                         |
| Checkstyleã®å®Ÿè¡Œ | ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯æŒ‡å®šã—ãŸCheckstyleã‚’å®Ÿè¡Œã™ã‚‹ã€‚                                                               |
| Reviewdog     | Reviewdogã¯lintãƒ„ãƒ¼ãƒ«ã®çµæœã‚’å—ã‘å–ã‚Šã€<br>PRã®å·®åˆ†ã«å¯¾ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã€‚ ![Reviewdog](images/reviewdog.png) |
| Reviewdogã®åˆ©ç”¨  | ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯Reviewdogã«Checkstyleã®å®Ÿè¡Œçµæœã‚’é€ä¿¡ã™ã‚‹ã€‚                                                    |
</details>
<br>

- **Step 7: ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’åé›†ã—Codecovã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹**

```
uses: codecov/codecov-action@v3
```

<details>
<summary>æ©Ÿèƒ½</summary>

| æ©Ÿèƒ½         | èª¬æ˜                                                                                                                                                                                  |
|------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Codecov    | ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’åé›†ã—ã‚°ãƒ©ãƒ•ã‚„ãƒ¬ãƒãƒ¼ãƒˆã¨ã—ã¦å¯è¦–åŒ–ã™ã‚‹ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹ã€‚ ![Codecov](images/codecov.png)                                                                                                                 |
| Codecovã®åˆ©ç”¨ | ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯`build/reports/jacoco/test/jacocoTestReport.xml`ã‹ã‚‰<br>ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’åé›†ã—ã€Codecovã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚<br>GitHubã¨é€£æºã•ã›ã‚‹ã“ã¨ã§PRä½œæˆæ™‚ã«ã‚«ãƒãƒ¬ãƒƒã‚¸ã®å¤‰åŒ–é‡ã‚’æ•™ãˆã¦ãã‚Œã‚‹ã€‚ ![Codecov result](images/codecov-result.png) |
</details>
<br>

- **Step 8: SpotBugsã§ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«ãƒã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒãªã„ã‹ç¢ºèªã™ã‚‹**

```
run: ./gradlew spotbugsMain
```
<br>

- **Step 9: SpotBugsã®çµæœã‚’GitHubä¸Šã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹**

```
uses: actions/upload-artifact@v1
```
<details>
<summary>æ©Ÿèƒ½</summary>

| æ©Ÿèƒ½        | èª¬æ˜                                                                                               |
|-----------|--------------------------------------------------------------------------------------------------|
| Artifacts | ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’<br>ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã¨ã—ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—GitHubä¸Šã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ ![Artifact](images/artifacts.png) |
</details>
<br>

- **Step 10: CIã®çµæœã‚’Discordã«é€šçŸ¥ã™ã‚‹**

```
uses: sarisia/actions-status-discord@v1
```
<details>
<summary>æ©Ÿèƒ½</summary>

| æ©Ÿèƒ½         | èª¬æ˜                                                                                      |
|------------|-----------------------------------------------------------------------------------------|
| Discordã«é€šçŸ¥ | ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯CI/CDã®çµæœã‚’Discordã«é€šçŸ¥ã—ã¦ãã‚Œã‚‹<br>(ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒè±Šå¯Œ) ![Notification](images/notification.png) |
</details>
